class DragDrop{static MOVE_BY=20;static SCROLL_ZONE_HEIGHT=80;static SCROLL_AMOUNT=10;static MOVE_KEYS={38:"N",40:"S",39:"E",37:"W"};static DROP_ANIM_DURATION=300;#e="data-draggable";#t="data-dropzone";#o="data-dragging-box";#s=null;#i=!1;#n=!1;#r=!1;#a=null;#l=null;#h=[];#d=null;#c={mx:null,my:null,boxX:null,boxY:null,dx:null,dy:null};#g={x:0,y:0};#u={value:null,dropbox:null};constructor(){this.#x(this.#e,!0),this.#m()}#x(e,t){setTimeout((()=>{const o=document.querySelectorAll(`[${e}]`);if(0===o.length)throw new Error(`No element found with Attribute "${e}"`);o.forEach((e=>e.setAttribute("tabindex",t?"0":"")))}),10)}#m(){document.addEventListener("mousedown",this.#b),document.addEventListener("mouseup",this.#b),document.addEventListener("mousemove",this.#b),document.addEventListener("keydown",this.#b),document.addEventListener("keyup",this.#b),document.addEventListener("touchstart",this.#b,{passive:!1}),document.addEventListener("touchend",this.#b,{passive:!1}),document.addEventListener("touchmove",this.#b,{passive:!1})}#b=e=>{switch(e.type){case"mousedown":this.#p(e);break;case"mouseup":this.#D(e);break;case"mousemove":this.#v(e);break;case"touchstart":this.#T(e);break;case"touchend":this.#A(e);break;case"touchmove":this.#B(e);break;case"keydown":this.#E(e);break;case"keyup":this.#R(e)}};#p(e){const t=e.target.hasAttribute(this.#e)?e.target:e.target.closest(`[${this.#e}]`);t&&!this.#n&&(e.preventDefault(),this.#_(e,t),this.#O(e),this.#y(),window.requestAnimationFrame((()=>this.#w(e))))}#T(e){const t=e.target.hasAttribute(this.#e)?e.target:e.target.closest(`[${this.#e}]`);t&&!this.#n&&(this.#_(e,t),this.#O(e),this.#y(),window.requestAnimationFrame((()=>this.#w(e))))}#y(){if(this.#a)return;this.#a=this.#s.cloneNode(!0),this.#s.style.opacity=0,this.#a.removeAttribute(this.#e),this.#a.setAttribute(this.#o,"");let{width:e,height:t,x:o,y:s}=this.#s.getBoundingClientRect();o+=window.scrollX,s+=window.scrollY,this.#a.style.cssText=`\n        position: absolute;\n        width: ${e}px;\n        height: ${t}px;\n        top: ${s}px;\n        left: ${o}px;\n        box-shadow: 0 0 10px #00000080;\n        outline: 1px solid gray;\n        z-index: 999;\n        user-select: none;\n      `,document.querySelector("body").append(this.#a),this.#x(this.#e,!1),this.#x(this.#t,!0),this.onDragStart()}#w(e){if(this.#n){const t=window.innerHeight,o=this.#g.y,s=parseInt(this.#a.style.top),i=DragDrop.SCROLL_AMOUNT;o<DragDrop.SCROLL_ZONE_HEIGHT&&window.pageYOffset?(window.scrollBy(0,-i),this.#a.style.top=s-i+"px"):o>t-DragDrop.SCROLL_ZONE_HEIGHT&&(window.scrollBy(0,i),this.#a.style.top=s+i+"px"),window.requestAnimationFrame((()=>this.#w(e)))}}#D(e){if((e.target.closest(`[${this.#o}]`)??e.target)!==this.#a)return this.#I();this.#n&&(this.#d=this.#k()),this.#d&&this.#S(),this.#r=!1,this.#g={x:0,y:0},this.#I()}#A(e){e.target.closest(`[${this.#o}]`)??e.target;this.#n&&(this.#d=this.#k()),this.#d&&this.#S(),this.#r=!1,this.#g={x:0,y:0},this.#I()}#R(e){if("Tab"!==e.key)return!0;const t=document.activeElement.hasAttribute(this.#t);if(this.#u=t?{value:!0,dropbox:document.activeElement}:{value:!1,dropbox:null},this.onTabKeypress(),this.#n)return e.preventDefault();this.#i=document.activeElement.hasAttribute(this.#e),this.#i&&(this.#s=document.activeElement)}#E(e){const t=DragDrop.MOVE_KEYS[e.keyCode];if(" "===e.key&&this.#i){if(e.preventDefault(),this.#r)return!0;if(this.#n){this.#d=this.#C();document.activeElement.hasAttribute(this.#t)&&(this.#d=document.activeElement),this.#d&&this.#S(),this.#I()}else this.#n=!0,this.#O(null),this.#f(this.#s)}else{if(this.#r||!t||!this.#a)return;e.preventDefault(),this.#f(this.#a),this.#L(t)}this.#n&&(this.#l=this.#s?.parentElement,this.#y(),this.#h=Array.from(document.querySelectorAll(`[${this.#t}]`)))}#I(){if(!this.#a)return;const{x:e,y:t}=this.#a.getBoundingClientRect(),{x:o,y:s}=this.#s.getBoundingClientRect(),i=Math.abs(o-e),n=Math.abs(s-t);let r=0;Math.max(i,n)>200&&(r=DragDrop.DROP_ANIM_DURATION),Object.assign(this.#a.style,{transition:r+"ms linear",top:window.scrollY+s+"px",left:window.scrollX+o+"px"}),setTimeout((()=>{this.#s.style.opacity=1,this.#n=!1,this.#s.focus(),this.#a?.remove(),this.#a=null,this.#f(this.#s)}),r),this.#x(this.#e,!0),this.#x(this.#t,!1),this.#u={value:null,dropbox:null},this.onDragEnd()}#S(){const e=this.#s.cloneNode(!0);this.#d.appendChild(e),this.#d.removeAttribute(this.#t),this.#l.setAttribute(this.#t,""),this.#d.removeAttribute("tabindex"),this.#l.setAttribute("tabindex",0),this.#s.remove(),this.#s=e,this.#s.focus()}#v(e){this.#n&&this.#r&&this.#G(e)}#B(e){this.#n&&this.#r&&(e.preventDefault(),this.#G(e))}#G(e){const{clientX:t,clientY:o}=e.touches?e.touches[0]:e;let s,i;this.#g={x:t,y:o},s=t-this.#c.mx,i=o-this.#c.my;let n=window.scrollX+this.#c.mx+s-this.#c.dx,r=window.scrollY+this.#c.my+i-this.#c.dy;this.#a.style.top=r+"px",this.#a.style.left=n+"px";const a=this.#k();this.#u={value:!!a,dropbox:a},this.onDrag()}#L(e){const t=parseInt(this.#a.style.top),o=parseInt(this.#a.style.left),s=DragDrop.MOVE_BY;switch(e){case"N":this.#a.style.top=t-s+"px";break;case"S":this.#a.style.top=t+s+"px";break;case"E":this.#a.style.left=o+s+"px";break;case"W":this.#a.style.left=o-s+"px"}const i=this.#C();this.#u={value:!!i,dropbox:i},null===this.onKeyDrag()?this.onKeyDrag():this.onDrag()}#_(e,t){this.#s=t,this.#l=t.parentElement,this.#i=!0,this.#n=!0,this.#r=!0;const{clientX:o,clientY:s}=e.touches?e.touches[0]:e;this.#g={x:o,y:s},this.#h=Array.from(document.querySelectorAll(`[${this.#t}]`))}#O(e){const{left:t,top:o}=this.#s.getBoundingClientRect();if(e)var{clientX:s,clientY:i}=e.touches?e.touches[0]:e;else var s=t,i=o;this.#c={mx:s,my:i,boxX:t,boxY:o,dx:s-t,dy:i-o}}#k(){let{x:e,y:t}=this.#g,o=null;return this.#h.forEach((s=>{let{top:i,bottom:n,left:r,right:a}=s.getBoundingClientRect();t>=i&&t<=n&&e>=r&&e<=a&&(o=s)})),o}#C(){const{top:e,left:t,width:o,height:s}=this.#a.getBoundingClientRect(),i=t+o/2,n=e+s/2;let r=null;return this.#h.forEach((e=>{let t=e.getBoundingClientRect();n>=t.top&&n<=t.bottom&&i>=t.left&&i<=t.right&&(r=e)})),r}#f(e){const t=e.getBoundingClientRect(),o=window.innerWidth||document.documentElement.clientWidth,s=window.innerHeight||document.documentElement.clientHeight;t.bottom>0&&t.right>0&&t.left<o&&t.top<s||e.scrollIntoView({block:"center",behavior:"smooth"})}get candrop(){return this.#u}removeEventListners(){document.removeEventListener("mousedown",this.#b),document.removeEventListener("mouseup",this.#b),document.removeEventListener("mousemove",this.#b),document.removeEventListener("keydown",this.#b),document.removeEventListener("keyup",this.#b),document.removeEventListener("touchstart",this.#b,{passive:!1}),document.removeEventListener("touchend",this.#b,{passive:!1}),document.removeEventListener("touchmove",this.#b,{passive:!1})}setDragDropElements(e){if(0===Object.entries(e).length)return;const{boxAttr:t,dropboxAttr:o,dragboxAttr:s}=e;this.#e=t??"nullAttribute",this.#t=o??"nullAttribute",this.#o=s??"nullAttribute",this.#x(this.#e,!0),this.#x(this.#t,!0)}onDragStart=()=>null;onDrag=()=>null;onKeyDrag=()=>null;onDragEnd=()=>null;onTabKeypress=()=>null}